<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T·ª´ m·ªõi giao ti·∫øp</title>

<!-- PapaParse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#e9eef4;
}
.app{
  max-width:420px;
  margin:auto;
  background:#fff;
  min-height:100vh;
  padding:16px;
}
h1{text-align:center}
.hidden{display:none}
.list button{
  width:100%;
  padding:14px;
  margin:6px 0;
  border:none;
  border-radius:12px;
  font-size:16px;
  background:#f1f3f6;
}
.card{
  height:220px;
  border-radius:16px;
  background:#f6f7fb;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
  text-align:center;
  padding:20px;
}
.controls button{
  width:48%;
  padding:12px;
  border:none;
  border-radius:12px;
  font-size:16px;
}
.good{background:#4caf50;color:#fff}
.bad{background:#f44336;color:#fff}
.top{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}
</style>
</head>

<body>
<div class="app">

<!-- GI√ÅO TR√åNH -->
<div id="library">
  <h1>Gi√°o Tr√¨nh</h1>
  <p id="loading" style="text-align:center;color:#999">
    ƒêang t·∫£i d·ªØ li·ªáu...
  </p>
  <div id="level-list" class="list"></div>
</div>

<!-- H·ªåC -->
<div id="study" class="hidden">
  <div class="top">
    <b id="lesson-name"></b>
    <span id="card-progress"></span>
  </div>

  <div class="card" onclick="flipCard()">
    <div id="front-text"></div>
    <div id="back-text" class="hidden"></div>
  </div>

  <div class="controls" style="margin-top:12px">
    <button class="bad" onclick="next()">‚ùå Ch∆∞a nh·ªõ</button>
    <button class="good" onclick="next()">‚úÖ ƒê√£ nh·ªõ</button>
  </div>
</div>

</div>

<script>
const CSV_URL =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vS9uWZ2kz54fpqjGrQ9L-BaPyrA_BXaO50O0aCX-hrpgC18bu6uW0CvIQ4ZVmJxKSbXasHu4M8cWTml/pub?gid=861638906&single=true&output=csv';

let data=[], lesson=[], idx=0;

Papa.parse(CSV_URL,{
  download:true,
  header:true,
  skipEmptyLines:true,
  complete:(res)=>{
    data = res.data.filter(r=>r['Ti·∫øng Nh·∫≠t'] && r['Ti·∫øng Vi·ªát']);
    renderLibrary();
  },
  error:(err)=>{
    document.getElementById('loading').innerText='‚ùå L·ªói t·∫£i d·ªØ li·ªáu';
    console.error(err);
  }
});

function renderLibrary(){
  document.getElementById('loading').remove();
  const box=document.getElementById('level-list');

  const lessons=[...new Set(data.map(d=>d['B√†i']))];

  lessons.forEach(l=>{
    const b=document.createElement('button');
    b.innerText='B√†i '+l;
    b.onclick=()=>startLesson(l);
    box.appendChild(b);
  });
}

function startLesson(l){
  lesson=data.filter(d=>d['B√†i']==l);
  idx=0;
  document.getElementById('library').classList.add('hidden');
  document.getElementById('study').classList.remove('hidden');
  show();
}

function show(){
  const w=lesson[idx];
  document.getElementById('front-text').innerText=w['Ti·∫øng Nh·∫≠t'];
  document.getElementById('back-text').innerText=w['Ti·∫øng Vi·ªát'];
  document.getElementById('back-text').classList.add('hidden');
  document.getElementById('lesson-name').innerText='B√†i '+w['B√†i'];
  document.getElementById('card-progress').innerText=
    `${idx+1}/${lesson.length}`;
}

function flipCard(){
  document.getElementById('back-text').classList.toggle('hidden');
}

function next(){
  idx++;
  if(idx>=lesson.length){
    alert('üéâ Ho√†n th√†nh!');
    location.reload();
  }else show();
}
</script>
</body>
</html>
