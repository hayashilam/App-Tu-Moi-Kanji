<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>T·ª´ m·ªõi giao ti·∫øp</title>

<style>
body{
    margin:0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
    background:#e9eef4;
}
.app{
    max-width:420px;
    margin:auto;
    background:#fff;
    min-height:100vh;
    padding:16px;
}
h1{
    text-align:center;
}
.hidden{display:none}
.list button{
    width:100%;
    padding:14px;
    margin:6px 0;
    border:none;
    border-radius:12px;
    font-size:16px;
    background:#f1f3f6;
    cursor:pointer;
}
.card{
    height:220px;
    border-radius:16px;
    background:#f6f7fb;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    text-align:center;
    padding:20px;
}
.controls button{
    width:48%;
    padding:12px;
    border:none;
    border-radius:12px;
    font-size:16px;
}
.good{background:#4caf50;color:#fff}
.bad{background:#f44336;color:#fff}
.top{
    display:flex;
    justify-content:space-between;
    margin-bottom:10px;
}
</style>
</head>

<body onload="initApp()">
<div class="app">

<!-- M√ÄN GI√ÅO TR√åNH -->
<div id="library">
    <h1>Gi√°o Tr√¨nh</h1>
    <p id="loading" style="text-align:center;color:#999">ƒêang t·∫£i d·ªØ li·ªáu...</p>
    <div id="level-list" class="list"></div>
</div>

<!-- M√ÄN H·ªåC -->
<div id="study" class="hidden">
    <div class="top">
        <b id="lesson-name"></b>
        <span id="card-progress"></span>
    </div>
    <div class="card" id="card" onclick="flipCard()">
        <div id="front-text"></div>
        <div id="back-text" class="hidden"></div>
    </div>
    <div class="controls" style="margin-top:12px">
        <button class="bad" onclick="mark(false)">‚ùå Ch∆∞a nh·ªõ</button>
        <button class="good" onclick="mark(true)">‚úÖ ƒê√£ nh·ªõ</button>
    </div>
</div>

</div>

<script>
const CSV_URL =
'https://docs.google.com/spreadsheets/d/e/2PACX-1vS9uWZ2kz54fpqjGrQ9L-BaPyrA_BXaO50O0aCX-hrpgC18bu6uW0CvIQ4ZVmJxKSbXasHu4M8cWTml/pub?gid=861638906&single=true&output=csv';

let allWords=[], currentVocab=[], curIdx=0;

function parseCSV(text){
    const rows=[]; let row=[], cell='', inside=false;
    for(let i=0;i<text.length;i++){
        const c=text[i], n=text[i+1];
        if(c=='"' && inside && n=='"'){ cell+='"'; i++; }
        else if(c=='"'){ inside=!inside; }
        else if(c==',' && !inside){ row.push(cell); cell=''; }
        else if(c=='\n' && !inside){
            row.push(cell); rows.push(row);
            row=[]; cell='';
        } else cell+=c;
    }
    if(cell) row.push(cell);
    if(row.length) rows.push(row);
    return rows;
}

async function initApp(){
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const rows = parseCSV(text);
    rows.shift();

    allWords = rows.map(r=>({
        h:r[0]?.trim(),
        n:r[1]?.trim(),
        b:r[2]?.trim() || 'Kh√°c',
        l:r[3]?.trim() || '1'
    })).filter(w=>w.h && w.n);

    renderLibrary();
}

function renderLibrary(){
    document.getElementById('loading').remove();
    const levels = [...new Set(allWords.map(w=>w.b))];
    const list = document.getElementById('level-list');
    levels.forEach(l=>{
        const b=document.createElement('button');
        b.innerText=l;
        b.onclick=()=>startLevel(l);
        list.appendChild(b);
    });
}

function startLevel(level){
    currentVocab = allWords.filter(w=>w.b===level);
    curIdx=0;
    document.getElementById('library').classList.add('hidden');
    document.getElementById('study').classList.remove('hidden');
    showCard();
}

function showCard(){
    const w=currentVocab[curIdx];
    document.getElementById('front-text').innerText=w.h;
    document.getElementById('back-text').innerText=w.n;
    document.getElementById('back-text').classList.add('hidden');
    document.getElementById('lesson-name').innerText='B√†i '+w.l;
    document.getElementById('card-progress').innerText=
        `${curIdx+1}/${currentVocab.length}`;
}

function flipCard(){
    document.getElementById('back-text').classList.toggle('hidden');
}

function mark(ok){
    curIdx++;
    if(curIdx>=currentVocab.length){
        alert('üéâ Ho√†n th√†nh!');
        location.reload();
    }else showCard();
}
</script>

</body>
</html>
